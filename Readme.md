# Project ROV

این پروژه یک **سامانه‌ی کنترل پیشرفته برای ربات زیرسطحی (ROV)** است که با هدف دستیابی به **کنترل دقیق، پایدار و بلادرنگ (Real-Time)** طراحی شده است. ساختار این سیستم ترکیبی از توان پردازشی بالا در **Raspberry Pi 5** و کنترل سطح پایین با **ESP32** است که از طریق **USB Serial** با یکدیگر در ارتباط‌اند. برای تبادل داده‌ها از **پروتکل MAVLink** به‌عنوان استاندارد ارتباطی بین ربات و ایستگاه زمینی **Cockpit** استفاده می‌شود.

---

##  ساختار کلی سیستم

در این پروژه، **Raspberry Pi** به‌عنوان مغز اصلی ربات وظیفه هماهنگی بین تمامی زیرسیستم‌ها را دارد؛ شامل:

* مدیریت و دریافت داده‌های حسگرها
* کنترل تراسترها و ماژول ویدئویی
* برقراری ارتباط با Cockpit از طریق ماژول‌های API

در مقابل، **ESP32** مسئول وظایف سطح پایین‌تر است:

* کنترل مستقیم عملگرها (تراسترها و LEDها)
* خواندن داده‌های فشار، دما و ولتاژ
* ارسال داده‌ها در قالب بسته‌های MAVLink به Raspberry Pi

---

##  ارتباط نرم‌افزاری

ارتباط بین **Cockpit** و **Raspberry Pi** از طریق پوشه‌ی `api` انجام می‌شود.
پیام‌های دریافتی از Cockpit توسط فایل `message_handler.py` مدیریت می‌شوند. برای نمونه، تابع زیر وظیفه‌ی دریافت داده‌های گیم‌پد از ایستگاه زمینی را دارد:

```python
async def manual_control_handler(msg: mavlink.MAVLink_manual_control_message):
```

در این پروژه از **برنامه‌نویسی غیرهمزمان (Asynchronous Programming)** استفاده شده است تا عملیات ورودی/خروجی (I/O) بدون قفل شدن برنامه انجام شوند. این معماری موجب می‌شود سیستم در لحظه، داده‌ها را دریافت کرده و هم‌زمان سایر توابع نیز اجرا شوند — در نتیجه کنترل **Real-Time** حاصل می‌شود.

---

##  ساختار نرم‌افزار

نرم‌افزار با رویکرد **ماژولار (Modular Design)** توسعه یافته است تا نگهداری و گسترش آن آسان باشد:

* **`robot_core/pid.py`**
  شامل کنترل‌کننده‌های PID برای محورهای **Yaw**, **Pitch** و **Depth** است که پایداری حرکتی ربات را تضمین می‌کند.

* **`robot_core/robot.py`**
  قلب نرم‌افزار است و به‌عنوان مرکز هماهنگی بین تمام ماژول‌ها عمل می‌کند. داده‌ها از حسگرها و ماژول‌ها دریافت شده و برای سایر بخش‌ها آماده‌سازی می‌شوند.
  به‌عنوان مثال، داده‌ی عمق ربات از ESP32 گرفته و در متغیر `esp_depth = 0.0` ذخیره می‌شود تا توسط `message_builder.py` به Cockpit ارسال گردد.

* **`robot_core/message_builder.py`**
  وظیفه‌ی ساخت و ارسال پیام‌های MAVLink از Raspberry Pi به Cockpit را برعهده دارد.

---

## ارتباط با ESP32

در سمت **ESP32** داده‌های ۱۲ بیتی از Raspberry Pi دریافت می‌شوند. این داده‌ها برای کنترل موتور‌ها و LED‌ها استفاده می‌شوند.
اعداد ۱ تا ۹ هر کدام بیانگر حالت حرکتی متفاوتی هستند — مثلاً:

* عدد **۸** → حرکت مستقیم به جلو
* عدد **۹** → حرکت مورب به سمت راست

هر داده ترکیبی از جهت و قدرت موتور‌ها است. توان هر موتور در بازه‌ی **۰ تا ۹۹** تنظیم شده و در قالب همین بسته‌ی ۱۲ بیتی ارسال می‌شود. این ساختار فشرده و بهینه باعث می‌شود کنترل حرکات ربات بسیار سریع و دقیق انجام گیرد.

---

##  دیاگرام الکترونیکی

![electronic diagram](/image_gif/diagram.png)

---

##  ویژگی‌های کلیدی

* طراحی ماژولار و قابل توسعه
* ارتباط Real-Time با Cockpit
* استفاده از MAVLink برای تبادل داده
* کنترل PID برای پایداری حرکتی
* مدیریت هم‌زمان چند سنسور و تراستر
* پشتیبانی از برنامه‌نویسی غیرهمزمان برای کارایی بالا

---

##  خلاصه

این پروژه ترکیبی از **سخت‌افزار قدرتمند** و **معماری نرم‌افزاری هوشمند** است که امکان کنترل دقیق، مشاهده داده‌های زنده و انجام مانورهای پیچیده را در محیط‌های زیرسطحی فراهم می‌کند.
**Project ROV** گامی به‌سوی رباتیک زیرآبی هوشمند است.

---
## دموی پروژه را می توانید از لینک زیر تماشا کنید
https://drive.google.com/drive/folders/1h5RaRMok-oDprnud1FtFUqWAuBtHD1Ev?usp=sharing

![electronic diagram](/image_gif/Hamoor.jpg)
---
